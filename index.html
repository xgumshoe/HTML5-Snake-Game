<!DOCTYPE html>
<html>
	<head>
		<title>Snake</title>
	<style>
	* {
		margin: 0;
		padding: 0;
	}
	body{
		background: black;
	}
	#game {
		margin: auto;
		position: absolute;
		left: 0;
		right: 0;
	}
	</style>
	</head>
	<body>
		<canvas id='game' width='500' height='700' style='background: rgba(0, 0, 0, 1);'></canvas>
		<a href="https://createjs.com/" target="_blank">
			<img id="logo" src="https://createjs.com/mediakit/createjs-badge-reverse.png" style="position:absolute; right: 0px; bottom: 0px;">
		</a>
		<script src='./js/plugins/createjs.min.js'></script>
		<script>
		var stage = new createjs.Stage('game');
		var GRID = 20;
		
		// Title
		var title = stage.addChild(new createjs.Text("SNAKE", "Bold 20px Arial", "white"));
		title.textAlign = "center";
		title.textBaseline = "middle";
		title.x = stage.canvas.width/2;
		title.y = 100;
		
		// Game screen
		var screen = stage.addChild(new createjs.Container());
		screen.x = 50;
		screen.y = 200;
		
		// Background
		var bg = screen.addChild(new createjs.Shape());
		bg.graphics
			.beginStroke('rgba(255, 255, 255, 1)').setStrokeStyle(2)
			.beginFill('rgba(0, 0, 0, 1)').drawRect(0, 0, GRID * 20, GRID * 20);
		
		// Snake
		var snake = {
			x: 0, // x coordinate
			y: 0, // y coordinate
			
			// velocity, moves one grid at a time
			dx: GRID,
			dy: 0,
			
			cells: [], // snake body
			maxCells: 4, // length of snake
			body: screen.addChild(new createjs.Shape()) // display object
		};
		
		// Apple
		var apple = { 
			x: 0, // x coordinate
			y: 0, // y coordinate
			
			body: screen.addChild(new createjs.Shape()), // display object
			create: function() { // Creates apple to unoccupied coordinate
				do {
					// Randoms (0 to Grid) * GRID
					var x = Math.floor(Math.random() * GRID) * GRID;
					var y = Math.floor(Math.random() * GRID) * GRID;
					
					var occupied = snake.cells.find(c => { snake.x === x && snake.y === y })
					if(occupied === undefined) {
						apple.x = x;
						apple.y = y;
						break;
					}
				} while(true)
			}
		};
		apple.create();
		
		// Update game
		function update() {		
			// Move snake by it's velocity
			snake.x += snake.dx;
			snake.y += snake.dy;
			
			// Wrap snake position horizontally
			if(snake.x < 0) {
				snake.x = bg.graphics.command.w - GRID;
			} else if(snake.x >= bg.graphics.command.w) {
				snake.x = 0;
			}
			
			// Wrap snake position vertically
			if(snake.y < 0) {
				snake.y = bg.graphics.command.h - GRID;
			} else if(snake.y >= bg.graphics.command.h) {
				snake.y = 0;
			}
			
			// Adds cell in front
			snake.cells.unshift({x: snake.x, y: snake.y });
			
			// Remove last cell if exceeds the body
			if(snake.cells.length > snake.maxCells) {
				snake.cells.pop();
			}
			
			// Draw apple
			apple.body.graphics.clear().beginFill('rgba(255, 0, 0, 1)').drawRoundRect(apple.x, apple.y, GRID-1, GRID-1, GRID/2);
			
			// Clear snake body
			snake.body.graphics.clear();
			// Draw snake body
			snake.cells.map(cell => {
				// snake body cell
				snake.body.graphics.beginFill('rgba(255, 255, 255, 1)').drawRect(cell.x, cell.y, GRID-1, GRID-1);
			
				// Eats apple if apple coordinates is within the snake body
				if(cell.x === apple.x && cell.y === apple.y) {
					snake.maxCells++; // Increase snake cell count
					
					apple.create();
				}
			});
			
			stage.update();
		}
			
		window.addEventListener('keydown', (e) => {
			if (e.keyCode === 37 && snake.dx === 0) { // Left arrow key
				snake.dx = -GRID;
				snake.dy = 0;
			} else if (e.keyCode === 38 && snake.dy === 0) { // Up arrow key
				snake.dy = -GRID;
				snake.dx = 0;
			} else if (e.keyCode === 39 && snake.dx === 0) { // Right arrow key
				snake.dx = GRID;
				snake.dy = 0;
			} else if (e.keyCode === 40 && snake.dy === 0) { // Down arrow key
				snake.dy = GRID;
				snake.dx = 0;
			}
		});
	
		createjs.Ticker.on('tick', update);
		</script>
	</body>
</html>
